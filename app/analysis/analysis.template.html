<column-template-dropdown columns="$ctrl.outerColumnNames" update-col-obj="$ctrl.updateCol(cols)" row-data="$ctrl.data" is-analysis="'true'" inner-columns="$ctrl.innerColumnNames" elem-name="$ctrl.elemName" date-range="$ctrl.datePicker.date">
</column-template-dropdown>

<h3>Data from {{$ctrl.datePicker.date.startDate}} until  {{$ctrl.datePicker.date.endDate}}</h3>

<!--Date Range Picker-->
<div class="drp-contain">
    <div>
        <!--This div for border-->
        <span class="glyphicon glyphicon-calendar"></span>
        <input date-range-picker class="form-control date-picker" type="text" ng-model="$ctrl.datePicker.date" options="$ctrl.DRPOptions" />
    </div>

</div>



<!-- Avg, Max, Min StdDev Checkboxes -->
<div>
    <button class="btn btn-primary" ng-click="$ctrl.startAnalysis()">Start Analysis</button>
    <div>
        <h3>
            <span ng-repeat="column in $ctrl.innerColumnNames">
                <input ng-model="column.isChecked" type="checkbox">
                {{column.name}}
            </span>
        </h3>
    </div>
</div>

<table st-table="$ctrl.displayed" st-safe-src="$ctrl.data" class="table table-striped">
    <thead>
        <!-- Outer Columns -->
        <tr>
            <th></th>
            <th ng-repeat="outerColumn in $ctrl.outerColumnNames" ng-if="outerColumn.isChecked" lr-drag-src="header" lr-drop-target="header">
                {{outerColumn.name}}
            </th>
        </tr>

        <!-- Conditional Formatting Settings Row  -->
        <tr ng-if="$ctrl.showFormattingSettingsButtons">
            <!-- 1 blank space for building and name (takes up 1 td) -->
            <td> </td>
            <td ng-repeat="column in $ctrl.outerColumnNames" ng-if="column.isChecked">
                <div class="btn-group-xs" role="group" aria-label="...">
                    <button ng-click="$ctrl.openCogModal(column)" type="button" class="btn btn-default glyphicon glyphicon-cog"></button>
                    <button ng-click="cf.toggleConditionalFormatting(column)" type="button" class="btn btn-default  glyphicon glyphicon-pencil"></button>
                    <button ng-click="column.isChecked=false" type="button" class="btn btn-default glyphicon glyphicon-trash"></button>
                </div>
            </td>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>
                <table class="table table-striped">
                    <th st-sort="name">Name</th>
                    <th st-sort="building">Building</th>
                    <tr ng-repeat="element in $ctrl.displayed">
                        <td>{{element.name}}</td>
                        <td>{{element.building}}</td>
                    </tr>
                </table>
            </td>
            <td ng-repeat="outerColumn in $ctrl.outerColumnNames" ng-if="outerColumn.isChecked">
                <table class="table table-striped">
                    <th ng-repeat="innerColumn in $ctrl.innerColumnNames" ng-if="innerColumn.isChecked" st-sort="$ctrl.getters.value.bind(null, outerColumn.name, innerColumn.name)">
                        {{innerColumn.name}}
                    </th>
                    <tr ng-repeat="element in $ctrl.displayed">
                        <td ng-repeat="innerColumn in $ctrl.innerColumnNames"
                            ng-if="innerColumn.isChecked"
                            ng-class="$ctrl.valueStyle(element[outerColumn.name][innerColumn.name])"
                            ng-style="cf.conditionalFormat(element[outerColumn.name][innerColumn.name], outerColumn, $ctrl.maxAndMin[outerColumn.name], 'true')">
                                {{$ctrl.formatValue(element[outerColumn.name][innerColumn.name])}}
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </tbody>
</table>


<!-- Conditional Formatting Settings Modal (cog button)-->
<div ng-class="" class="modal fade formattingSettingsModalAnalysis" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Conditional Formatting Settings for Column "{{$ctrl.currentFormattingSettingsCol.name}}"</h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" id="conditionalFormatFormAnalysis">
                    <label ng-if="!cf.isUndefined($ctrl.currentFormattingSettingsCol.max)" for="maxInput" class="control-label">Set Max for {{$ctrl.currentFormattingSettingsCol.name}}: (Currently set at {{$ctrl.currentFormattingSettingsCol.max}})</label>
                    <label ng-if="cf.isUndefined($ctrl.currentFormattingSettingsCol.max)" for="maxInput" class="control-label">Set Max for {{$ctrl.currentFormattingSettingsCol.name}}: </label>
                    <input class="form-control" id="maxInputAnalysis" value="{{$ctrl.maxAndMin[$ctrl.currentFormattingSettingsCol.name].max}}">


                    <label ng-if="!cf.isUndefined($ctrl.currentFormattingSettingsCol.min)" for="minInput" class="control-label">Set Min for {{$ctrl.currentFormattingSettingsCol.name}}: (Currently set at {{$ctrl.currentFormattingSettingsCol.min}})</label>
                    <label ng-if="cf.isUndefined($ctrl.currentFormattingSettingsCol.min)" for="minInput" class="control-label">Set Min for {{$ctrl.currentFormattingSettingsCol.name}}: </label>
                    <input class="form-control" id="minInputAnalysis" value="{{$ctrl.maxAndMin[$ctrl.currentFormattingSettingsCol.name].min}}">


                    <label for="maxColor">Color for Max: (Currently set at {{$ctrl.currentFormattingSettingsCol.maxColor}})</label>
                    <select class="form-control" id="maxColorAnalysis">
                <option>Red</option>
                <option>Blue</option>
                <option>Green</option>
                <option>Purple</option>
            </select>

                    <label for="minColor">Color for Min: (Currently set at {{$ctrl.currentFormattingSettingsCol.minColor}})</label>
                    <select class="form-control" id="minColorAnalysis">
                <option>Blue</option>
                <option>Red</option>
                <option>Green</option>
                <option>Purple</option>
            </select>


                </form>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button ng-click="cf.submitFormattingSettings($ctrl.currentFormattingSettingsCol)" type="button" class="btn btn-default" data-dismiss="modal">Save
        </button>

            </div>
        </div>

    </div>
</div>
